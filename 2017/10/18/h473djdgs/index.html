<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Open your API to change the internet, open your mind to change the world."><meta name="keywords" content="Renpingjun,仁平君,javascript,前端开发，web,终南山下,汉水之滨,仁平君者,独步武林"><title>JavaScript正则表达式匹配汉字 | Renpingjun's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">JavaScript正则表达式匹配汉字</h1><a id="logo" href="/.">Renpingjun's Blog</a><p class="description">Open your API to change the internet, open your mind to change the world.</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Please input keywords"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">JavaScript正则表达式匹配汉字</h1><div class="post-meta"><a href="/2017/10/18/h473djdgs/#comments" class="comment-count"></a><p><span class="date">Oct 18, 2017</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>Hits</i></i></span></p></div><div class="post-content"><h2 id="一-正则汉字匹配现状"><a href="#一-正则汉字匹配现状" class="headerlink" title="一 正则汉字匹配现状"></a>一 正则汉字匹配现状</h2><p>在谷歌搜索「JavaScript 正则表达式匹配汉字」的时候，前几条结果全都是 /[\u4e00-\u9fa5]/。没有人怀疑这个正则表达式有什么问题，那么在 2018 年的今天，让我们站在 Chrome 64 的肩膀上，放飞一下自我。</p>
<p>汉文（Han Script）是汉语、日本语、朝鲜语、韩国语的书写系统中的一种文字（Script），越南语在早期也曾在书写系统中使用汉文[1]。汉字（CJK Ideograph）是汉文的基本单元。各国都对汉字提出了自己的编码标准，Unicode 将这些标准加总在一起进行统一编码，力求实现原标准与 Unicode 编码之间的无损转换。Unicode 从语义（semantic）、抽象字形（abstract shape），具体字形（typeface）三个维度[2]出发，把不同编码标准里「起源相同、本义相同、形状一样或稍异」的汉字赋予相同编码，这些被编码的字符称为中日韩统一表意文字（下文我们提到的「汉字」，如果不加说明，均指代中日韩统一表意文字）。如果把它们全部列举出来写成正则表达式，那么就是技术上完整的匹配汉字的正则表达式了。</p>
<p>正则表达式 /[\u4e00-\u9fa5]/的意思是匹配所有从 U+4E00, cjk unified ideograph-4e00 到 U+9FA5, cjk unified ideograph-9fa5 的字符。这一段区域对应的是 Unicode 1.0.1 就收录进来的中日韩统一表意文字（CJK Unified Ideographs）区块，在 Unicode 3.0 加入扩展 A 区以前，这个正则表达式确实给出了所有汉字的编码。换言之，从1992年到1999年，这个正则表达式确实是正确的，想必这个表达式已经有20年历史了。</p>
<h2 id="二-匹配所有统一表意文字"><a href="#二-匹配所有统一表意文字" class="headerlink" title="二 匹配所有统一表意文字"></a>二 匹配所有统一表意文字</h2><p>然而时光飞逝，Unicode 在2017年6月发布了10.0.0版本。在这20年间，Unicode 添加了许多汉字。比如 Unicode 8.0 添加的 109 号化学元素「鿏（⿰⻐麦）」，其码点是 9FCF，不在这个正则表达式范围中。而如果我们期望程序里的 /[\u4e00-\u9fa5]/可以与时俱进匹配最新的 Unicode 标准，显然是不现实的事情。因此，我们需要换一个思路，写一个无需维护的正则表达式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/\p&#123;Unified_Ideograph&#125;/u</div></pre></td></tr></table></figure></p>
<p>其中 \u是 ECMAScript 2015 定义的正则表达式标志，意味着将表达式作为 Unicode 码点序列。 \p是正在提案阶段的正则表达式 Unicode 属性转义，它赋予了我们根据 Unicode 字符的属性数据[3]构造表达式的能力。 Unified_Ideograph是 Unicode 字符的一个二值属性，对于汉字，其取值为 Yes，否则为 No。因此\p{Unified_Ideograph}匹配所有满足 Unified_Ideograph=yes的 Unicode 字符，而它的底层实现由运行时所依赖的 Unicode 版本决定，开发者不需要知道汉字的具体 Unicode 码点范围。</p>
<h2 id="三-容易混淆的其他-Unicode-属性转义表达式"><a href="#三-容易混淆的其他-Unicode-属性转义表达式" class="headerlink" title="三 容易混淆的其他 Unicode 属性转义表达式"></a>三 容易混淆的其他 Unicode 属性转义表达式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/\p&#123;Ideographic&#125;/u</div></pre></td></tr></table></figure>
<p>这个表达式匹配所有满足 Ideographic=yes的 Unicode 字符。我们先看一下 UAX #44 对这个属性的解释：</p>
<p>Characters considered to be CJKV (Chinese, Japanese, Korean, and Vietnamese) or other siniform (Chinese writing-related) ideographs. This property roughly defines the class of “Chinese characters” and does not include characters of other logographic scripts such as Cuneiform or Egyptian Hieroglyphs.</p>
<p>这个属性表明该字符属于 CJKV 表意文字或者与汉语书写相关的其他表意文字（如西夏文、女书），这个属性粗略地定义了「中文字符」的分类。</p>
<h2 id="四-浏览器兼容性支持"><a href="#四-浏览器兼容性支持" class="headerlink" title="四 浏览器兼容性支持"></a>四 浏览器兼容性支持</h2><p>截至2018年1月，只有 Chrome 64 支持正则表达式 Unicode 属性转义。对于其他浏览器，我们需要用 babel转译插件@babel/plugin-proposal-unicode-property-regex的底层将带有属性转义的正则表达式转为 Unicode 码点正则表达式或者 ES 5 的正则表达式。转译结果的在线演示可以在这里查看，用户可以自己在上面转译其他的 Unicode 属性转义正则表达式。我们在这里列举 /\p{Unified_Ideograph}/u转译成Unicode 码点正则表达式的结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">const regex = /\p&#123;Unified_Ideograph&#125;/u;</div><div class="line">// transpiled to ES6:</div><div class="line">const regex =/[\u3400-\u4DB5\u4E00-\u9FEA\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29\u&#123;20000&#125;-\u&#123;2A6D6&#125;\u&#123;2A700&#125;-\u&#123;2B734&#125;\u&#123;2B740&#125;-\u&#123;2B81D&#125;\u&#123;2B820&#125;-\u&#123;2CEA1&#125;\u&#123;2CEB0&#125;-\u&#123;2EBE0&#125;]/u;</div></pre></td></tr></table></figure>
<p>该插件还可以使用:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;plugins&quot;: [</div><div class="line">    [&quot;@babel/plugin-proposal-unicode-property-regex&quot;, &#123; &quot;useUnicodeFlag&quot;: false &#125;]</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>配置将表达式转成 ES5 的传统的以字符的 UTF16 表示为序列的字符串，这里不再赘述。</p>
<ul>
<li>input 元素的 pattern 属性</li>
</ul>
<p>在前端技术中，除了JavaScript会用到正则表达式，HTML 里<input>元素的pattern属性也会用到正则表达式。与 JavaScript 相比，pattern不支持设置正则表达式的标志位，因此 HTML 标准中强制规定了 input 元素的 pattern 属性需要施加unicode标志 [6]。目前只有 Chrome 53+, Firefox 遵循了这一标准，其他的浏览器暂未支持。</p>
<p>在 React/Angular/Vue.js 三大前端框架中，Angular 提供了近似于 pattern 的指令 ngPattern。目前ngPattern尚未施加unicode标志 [7]。AngularJS 的 ngPattern directive 仍未施加。</p>
<p>在大部分情况，是否施加unicode标志不会对正则表达式产生语义区别。主要的差别在于，在使用\u{10000}表示 Unicode 码点字符情形，正则表达式/\u{10000}/代表匹配u一万次，/\u{10000}/u匹配字符\u{10000}一次；/./只匹配 BMP 平面的字符，/./u匹配所有平面的字符。</p>
<p>由于 Unicode 属性转义正则表达式依赖于标识位\u，因此下面的用法目前只能在 Chrome 下使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;input type=&quot;text&quot; pattern=&quot;\p&#123;Unified_Ideograph&#125;&quot;&gt;</div></pre></td></tr></table></figure>
<p>因此，如果需要兼容其他浏览器，可以使用转译插件的底层库regexpu-core在 js 层转换正则表达式，再把转换结果输送到 HTML 模版中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">const rewritePattern = require(&quot;regexpu-core&quot;);</div><div class="line">rewritePattern(&apos;\\p&#123;Unified_Ideograph&#125;&apos;, &apos;u&apos;, &#123;</div><div class="line">  &apos;unicodePropertyEscape&apos;: true,</div><div class="line">  &apos;useUnicodeFlag&apos;: false</div><div class="line">&#125;);</div><div class="line">// → &apos;/(?:[\u3400-\u4DB5\u4E00-\u9FEA\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0])/&apos;</div></pre></td></tr></table></figure>
<h2 id="五-总结"><a href="#五-总结" class="headerlink" title="五 总结"></a>五 总结</h2><ul>
<li><p>/[\u4e00-\u9fa5]/是错的，不要用二十年前的正则表达式了。</p>
</li>
<li><p>/\p{Unified_Ideograph}/u是正确的，不需要维护，匹配所有汉字。这里\p是 Unicode 属性转义正则表达式。</p>
</li>
<li><p>/\p{Ideographic}/u 和 /\p{Script=Han}/u 匹配了除了汉字以外的其他一些字符，在「汉字匹配正则表达式」这个需求下，是错的。</p>
</li>
<li><p>目前只有 Chrome 支持 Unicode 属性转义正则表达式。对其他环境，使用@babel/plugin-proposal-unicode-property-regex 和 regexpu-core 进行优雅降级。</p>
</li>
</ul>
<p><strong><em> 阅读原文：<a href="https://qianduan.group/posts/5a6ede120cf6b624d2239c8b" target="_blank" rel="external">https://qianduan.group/posts/5a6ede120cf6b624d2239c8b</a> </em></strong></p>
<p><img src="http://onjm2392k.bkt.clouddn.com/renpingjun/vgrefs548hf347hd23ie9ysh23.jpg" alt=""></p>
</div><div class="tags"><a href="/tags/JavaScript/">JavaScript</a><a href="/tags/正则表达式/">正则表达式</a></div><!--暂时不展示分享功能--><!--.post-share--><!--  include _partial/share--><div class="post-nav"><a href="/2018/01/18/hd4q76ta/" class="pre">http协议：从看懂浏览器http报文开始</a><a href="/2017/10/17/1f35839j/" class="next">JavaScript正则表达式匹配身份证号码</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">Contents</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一-正则汉字匹配现状"><span class="toc-text">一 正则汉字匹配现状</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二-匹配所有统一表意文字"><span class="toc-text">二 匹配所有统一表意文字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三-容易混淆的其他-Unicode-属性转义表达式"><span class="toc-text">三 容易混淆的其他 Unicode 属性转义表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四-浏览器兼容性支持"><span class="toc-text">四 浏览器兼容性支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五-总结"><span class="toc-text">五 总结</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Angular/">Angular</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript穷理尽微/">JavaScript穷理尽微</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Jquery/">Jquery</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发工具/">开发工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书之道/">读书之道</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/面试/">面试</a><span class="category-list-count">2</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> Tags</i></div><div class="tagcloud"><a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Jquery/" style="font-size: 15px;">Jquery</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/Angular/" style="font-size: 15px;">Angular</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> Archive</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> Blogroll</i></div><ul><li><a href="http://jspang.com/" title="技术胖博客" target="_blank">技术胖博客</a></li></ul><ul><li><a href="https://www.liaoxuefeng.com/" title="廖雪峰的官方网站" target="_blank">廖雪峰的官方网站</a></li></ul><ul><li><a href="http://www.ruanyifeng.com/home.html" title="阮一峰的个人网站" target="_blank">阮一峰的个人网站</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-hit"> Segmentfault</i></div><P>&nbsp;</P><p><script src='//w.segmentfault.com/card/1030000003050718.js?w=0&3rd=0&bg=0&bd=0&cl=333333&btn=009a61&noBtn=0'></script></p></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><!--if theme.baidusitemap--><!--  a(href=config.root+"baidusitemap.xml")= __("baidusitemap")--><!--  |  |--><a href="/atom.xml">RSS</a> |<a href="/about/">About</a></p><!--p 本站总访问量：--><!--  i#busuanzi_container_site_pv--><!--    i#busuanzi_value_site_pv--><!--  | 次--><p>Page views over  <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i> times</p><p><span> Copyright &copy;<a href="/." rel="nofollow">仁平君.</a></span><!--span  Theme by--><span>All rights reserved</span><!--  a(rel='nofollow', target='_blank', //href='https://github.com/chaooo/hexo-theme-BlueLake')  BlueLake.--><!--if theme.busuanzi == true--><!--  span  Count by--><!--    a(href="http://busuanzi.ibruce.info/")  busuanzi.--><!--span  Powered by--><!--  a(rel='nofollow', target='_blank', href='https://hexo.io')  Hexo.--></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script></body></html>